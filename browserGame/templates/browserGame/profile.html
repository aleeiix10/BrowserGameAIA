{% extends 'base.html' %}
{% load static %}
{% load render_bundle from webpack_loader %}
{% block title %} Index {% endblock %}
{% block content %}
<body class="bg-green-300">
    <header class="bg-green-700 text-white py-2">
        <div class="container mx-auto flex justify-between items-center px-4">
            <h1 class="text-xl">Dashboard {{user}}</h1>
            <a href="/accounts/logout/" class="underline">Logout</a>
        </div>
    </header>

    <main class="container mx-auto my-4">
        <h2 class="text-lg font-semibold mb-2">Informació personal usuari</h2>
        <table class="border border-black">
            <thead class="bg-green-700 text-white text-center">
                <tr>
                    <th class="p-2">
                        Nivell
                    </th>
                    <th class="p-2">
                        Vida
                    </th>
                    <th class="p-2">
                        Manà
                    </th>
                    <th class="p-2">
                        Experiència
                    </th>
                </tr>
            </thead>
            <tbody>
                <tr class="border-b border-black text-center" id="profileStats">
                    <td class="p-2" id="profileStatsLevel">

                    </td>
                    <td class="p-2" id="profileStatsLife">

                    </td>
                    <td class="p-2" id="profileStatsMana">

                    </td>
                    <td class="p-2" id="profileStatsExperience">

                    </td>
                </tr>
            </tbody>
        </table>
        {% if userLoged|length >= 1 %}
        <h2 class="text-lg font-semibold mt-4 mb-2">Últimes 30 accions realitzades</h2>
        <table class="border border-black">
            <thead class="bg-green-700 text-white text-center">
                <tr>
                    <th class="p-2">
                        Nom Acció
                    </th>
                    <th class="p-2">
                        Categoria
                    </th>
                    <th class="p-2">
                        Moment Acció
                    </th>
                    <th class="p-2">
                        Cost
                    </th>
                    <th class="p-2">
                        Èxit
                    </th>
                </tr>
            </thead>
            <tbody>
                {% for cnt in userLoged %}
                <tr class="border-b border-black text-center">
                    <td class="p-2">{{cnt.action.name}}</td>
                    <td class="p-2">{{cnt.action.get_category_display}}</td>
                    <td class="p-2">{{cnt.timestamp}}</td>
                    <td class="p-2">{{cnt.action.cost}}</td>
                    {% if cnt.success == True %}
                        <td class="p-2"><i class="fa fa-solid fa-circle-check" style="color: #316e32;"></i></td>
                    {% else %}
                        <td class="p-2"><i class="fa fa-sharp fa-solid fa-circle-xmark" style="color: #a73131;"></i></td>
                    {% endif %}
                </tr>
                {% endfor %}
            </tbody>
        </table>
        {% endif %}
    </main>
    <script>
        $(document).ready(function(){
            setInterval(getStats, 30000);
            function getStats() {
                $.getJSON("api/get_users", function(usuari){
                    $('#profileStatsLevel').text(usuari.UsersObj[0].level);
                    $('#profileStatsLife').text(usuari.UsersObj[0].current_life);
                    $('#profileStatsMana').text(usuari.UsersObj[0].current_mana);
                    $('#profileStatsExperience').text(usuari.UsersObj[0].experience);  
                })
            }
            getStats();
        });
    </script>
</body>
{% endblock %}
